version: "3.8"

services:
  # Spring Boot Application
  student-management-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: student-management-system
    ports:
      - "8080:8080"
    environment:
      # Spring Profile
      - SPRING_PROFILES_ACTIVE=docker

      # Database Configuration (H2 in-memory)
      - SPRING_DATASOURCE_URL=jdbc:h2:mem:studentdb
      - SPRING_DATASOURCE_DRIVER_CLASS_NAME=org.h2.Driver
      - SPRING_DATASOURCE_USERNAME=sa
      - SPRING_DATASOURCE_PASSWORD=

      # JPA Configuration
      - SPRING_JPA_DATABASE_PLATFORM=org.hibernate.dialect.H2Dialect
      - SPRING_JPA_HIBERNATE_DDL_AUTO=create-drop
      - SPRING_JPA_SHOW_SQL=true

      # H2 Console
      - SPRING_H2_CONSOLE_ENABLED=true
      - SPRING_H2_CONSOLE_PATH=/h2-console

      # Logging
      - LOGGING_LEVEL_OCTGUY_DEMOSPRINGBOOT=INFO
      - LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_SECURITY=WARN

      # JVM Options
      - JAVA_OPTS=-Xmx512m -Xms256m

    restart: unless-stopped

    networks:
      - student-network

    labels:
      - "com.example.description=Student Management System"
      - "com.example.version=1.0"

networks:
  student-network:
    driver: bridge
# Optional: Add volume for persistent data if switching to file-based H2
# volumes:
#   h2-data:
#     driver: local
